<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de √Åudio Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .main-content {
            padding: 30px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
        }

        .tab-button:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        textarea, select, input[type="file"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            resize: vertical;
        }

        textarea {
            min-height: 120px;
            font-family: inherit;
        }

        textarea:focus, select:focus, input[type="file"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        input[type="text"] {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .audio-player {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            text-align: center;
        }

        .audio-player audio {
            width: 100%;
            margin: 10px 0;
        }

        .recording-status {
            display: none;
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 15px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        .mic-status {
            display: none;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 15px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .saved-audios {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .saved-audios h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .audio-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .audio-info {
            flex: 1;
        }

        .audio-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .audio-date {
            font-size: 14px;
            color: #666;
        }

        .audio-actions {
            display: flex;
            gap: 10px;
        }

        .transcription-result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .voice-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .voice-control {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .voice-control label {
            font-size: 14px;
            margin-bottom: 0;
            color: #555;
        }

        .voice-control input, .voice-control select {
            padding: 10px 12px;
            font-size: 14px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }

        .gender-selector {
            display: flex;
            gap: 10px;
        }

        .gender-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .gender-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .gender-btn:hover:not(.active) {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .voice-effects {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .effect-btn {
            padding: 12px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .effect-btn.active {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-color: #28a745;
        }

        .effect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .waveform-visualizer {
            width: 100%;
            height: 60px;
            background: #2c3e50;
            border-radius: 10px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }

        .waveform-bars {
            display: flex;
            align-items: end;
            height: 100%;
            padding: 5px;
            gap: 2px;
        }

        .waveform-bar {
            flex: 1;
            background: linear-gradient(to top, #3498db, #2ecc71);
            border-radius: 1px;
            transition: height 0.1s ease;
        }

        .mp3-quality {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .quality-btn {
            padding: 8px 16px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .quality-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        
        #generatorOptions {
            margin-top: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
        }

        #generatorOptions > div {
            display: none;
            margin-top: 15px;
        }
        
        #generatorOptions > div.active {
            display: block;
        }

        .speaking-animation {
            display: none;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            margin: 15px 0;
        }

        .speaking-animation.active {
            display: block;
            animation: speakPulse 1s infinite alternate;
        }

        @keyframes speakPulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.02); opacity: 1; }
        }

        .voice-wave {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 3px;
            margin: 10px 0;
        }

        .wave-bar {
            width: 4px;
            background: white;
            border-radius: 2px;
            animation: waveAnimation 1.2s ease-in-out infinite;
        }

        .wave-bar:nth-child(2) { animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { animation-delay: 0.4s; }
        .wave-bar:nth-child(6) { animation-delay: 0.5s; }

        @keyframes waveAnimation {
            0%, 100% { height: 8px; }
            50% { height: 24px; }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .main-content {
                padding: 20px;
            }

            .tabs {
                flex-direction: column;
            }

            .controls {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }

            .audio-item {
                flex-direction: column;
                gap: 15px;
            }

            .audio-actions {
                width: 100%;
                justify-content: center;
            }

            .voice-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ Sistema de √Åudio Completo</h1>
            <p>Converta texto em √°udio MP3, grave, transcreva e gerencie seus arquivos de √°udio</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab-button active" onclick="openTab('tts', this)">üì¢ Texto para √Åudio</button>
                <button class="tab-button" onclick="openTab('record', this)">üé§ Gravar √Åudio</button>
                <button class="tab-button" onclick="openTab('audio-generator', this)">‚öôÔ∏è Gerador de √Åudios</button>
                <button class="tab-button" onclick="openTab('manage', this)">üíæ Gerenciar √Åudios</button>
            </div>

            <div id="tts" class="tab-content active">
                <h2>üì¢ Converter Texto em √Åudio MP3</h2>
                <div class="form-group">
                    <label for="textInput">Digite ou fale o texto:</label>
                    <textarea id="textInput" placeholder="Digite ou fale seu texto aqui..."></textarea>
                </div>
                
                <div class="voice-controls">
                    <div class="voice-control">
                        <label for="voiceSelect">Voz Espec√≠fica:</label>
                        <select id="voiceSelect"></select>
                    </div>

                    <div class="voice-control">
                        <label for="rateInput">Velocidade: <span id="rateValue">1.0x</span></label>
                        <input type="range" id="rateInput" min="0.5" max="2.5" value="1" step="0.1">
                    </div>

                    <div class="voice-control">
                        <label for="pitchInput">Tom: <span id="pitchValue">1.0</span></label>
                        <input type="range" id="pitchInput" min="0.5" max="2" value="1" step="0.1">
                    </div>
                </div>

                <div class="speaking-animation" id="speakingAnimation" style="display: none;">
                    <h3>üéôÔ∏è Falando...</h3>
                    <div class="voice-wave">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                </div>

                <div id="micStatus" class="mic-status" style="display: none;">
                    <span>üî¥ O sistema est√° ouvindo...</span>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="playBtn" onclick="toggleSpeech()">üîä Reproduzir</button>
                    <button class="btn btn-primary" onclick="spellWord()">üî° Soletrar</button>
                    <button class="btn btn-success" onclick="generateAndSaveMP3()">üíæ Salvar como MP3</button>
                    <button class="btn btn-secondary" onclick="stopSpeech()">‚èπÔ∏è Parar</button>
                    <button class="btn btn-primary" onclick="toggleVoiceCommand()">
                        <span id="mic-icon">üéôÔ∏è</span>
                        <span id="mic-text">Ativar Comando por Voz</span>
                    </button>
                </div>

                <div id="ttsPlayer" class="audio-player" style="display: none;">
                    <p>√Åudio gerado:</p>
                    <audio id="ttsAudioPlayer" controls></audio>
                    <div class="controls">
                        <button class="btn btn-success" onclick="downloadCurrentMP3()">‚¨áÔ∏è Download MP3</button>
                    </div>
                </div>
            </div>

            <div id="record" class="tab-content">
                <h2>üé§ Gravar √Åudio em MP3</h2>
                
                <div class="voice-control">
                    <label>Qualidade de Grava√ß√£o:</label>
                    <div class="mp3-quality">
                        <button class="quality-btn" onclick="selectRecordQuality('low', this)">128kbps</button>
                        <button class="quality-btn active" onclick="selectRecordQuality('medium', this)">192kbps</button>
                        <button class="quality-btn" onclick="selectRecordQuality('high', this)">320kbps</button>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-danger" id="startRecordBtn" onclick="startRecording()">‚è∫Ô∏è Iniciar Grava√ß√£o</button>
                    <button class="btn btn-secondary" id="stopRecordBtn" onclick="stopRecording()" disabled>‚èπÔ∏è Parar Grava√ß√£o</button>
                    <button class="btn btn-success" onclick="saveRecordedMP3()" id="saveRecordBtn" style="display: none;">üíæ Salvar MP3</button>
                </div>

                <div id="recordingStatus" class="recording-status" style="display: none;">
                    üî¥ Gravando... Fale agora!
                </div>

                <div class="waveform-visualizer" id="recordWaveform" style="display: none;">
                    <div class="waveform-bars" id="recordWaveformBars"></div>
                </div>

                <div id="recordPlayer" class="audio-player" style="display: none;">
                    <p>Grava√ß√£o em MP3:</p>
                    <audio id="recordAudioPlayer" controls></audio>
                    <div class="controls">
                        <button class="btn btn-success" onclick="downloadRecordedMP3()">‚¨áÔ∏è Download MP3</button>
                    </div>
                </div>
            </div>
            
            <div id="audio-generator" class="tab-content">
                <h2>‚öôÔ∏è Gerador de √Åudios</h2>
                <p>Gere √°udios de n√∫meros e letras para o jogo de bingo.</p>
                
                <div class="form-group">
                    <label for="generatorType">Tipo de Gera√ß√£o:</label>
                    <select id="generatorType" onchange="toggleGeneratorOptions()">
                        <option value="numbers">Gerar N√∫meros (1-100)</option>
                        <option value="specific_numbers">Gerar N√∫meros Espec√≠ficos</option>
                        <option value="letters">Gerar Letras</option>
                    </select>
                </div>
                
                <div id="generatorOptions">
                    <div id="numbers-options" class="active">
                        <label>Gerar de: <input type="number" id="startNumber" value="1" min="1"></label>
                        <label>at√©: <input type="number" id="endNumber" value="100" min="1"></label>
                    </div>
                    
                    <div id="specific-numbers-options">
                        <label>Digite os n√∫meros separados por v√≠rgula (ex: 1, 15, 25):</label>
                        <input type="text" id="specificNumbersInput" placeholder="Ex: 1, 15, 25">
                    </div>
                    
                    <div id="letters-options">
                        <label>Digite as letras separadas por v√≠rgula (ex: B, I, N, G, O):</label>
                        <input type="text" id="lettersInput" placeholder="Ex: B, I, N, G, O">
                    </div>
                </div>

                <div class="controls" style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="generateAudioFiles()">‚ñ∂Ô∏è Gerar √Åudios MP3</button>
                </div>
                
                <div id="generatorLoading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>Gerando √°udios... Aguarde!</p>
                </div>
                
                <div id="generatedAudioList" class="saved-audios" style="display: none;">
                    <h3>√Åudios Gerados:</h3>
                    <div id="generatedAudioItems"></div>
                    <button class="btn btn-success" onclick="downloadAllGeneratedAudios()">‚¨áÔ∏è Baixar Todos</button>
                </div>
            </div>

            <div id="manage" class="tab-content">
                <h2>üíæ √Åudios MP3 Salvos</h2>
                <div class="controls">
                    <button class="btn btn-danger" onclick="clearAllAudios()">üóëÔ∏è Limpar Todos</button>
                    <button class="btn btn-secondary" onclick="importMP3s()">üì• Importar MP3s</button>
                </div>

                <div id="savedAudiosList" class="saved-audios">
                    <p>Nenhum √°udio MP3 salvo ainda.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.0/lame.min.js"></script>
    
    <script>
        // Vari√°veis globais
        let mediaRecorder;
        let audioChunks = [];
        let currentAudioBlob = null;
        let savedAudios = JSON.parse(localStorage.getItem('savedAudios') || '[]');
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let currentMP3Blob = null;
        let recognition;
        let isVoiceCommandActive = false;
        
        // Dicion√°rio de n√∫meros para texto
        const unidades = ['', 'um', 'dois', 'tr√™s', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove'];
        const dezenas = ['', 'dez', 'vinte', 'trinta', 'quarenta', 'cinquenta', 'sessenta', 'setenta', 'oitenta', 'noventa'];
        const especiais = ['dez', 'onze', 'doze', 'treze', 'quatorze', 'quinze', 'dezesseis', 'dezessete', 'dezoito', 'dezenove'];
        const centenas = ['', 'cem', 'duzentos', 'trezentos', 'quatrocentos', 'quinhentos', 'seiscentos', 'setecentos', 'oitocentos', 'novecentos'];

        // Configura√ß√µes de qualidade MP3
        const qualitySettings = {
            low: { bitRate: 128, sampleRate: 44100 },
            medium: { bitRate: 192, sampleRate: 44100 },
            high: { bitRate: 320, sampleRate: 44100 }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadVoices();
            updateSavedAudiosList();
            setupRangeInputs();
            setupVoiceRecognition();
            toggleGeneratorOptions();
        });
        
        // Pausar/Continuar reprodu√ß√£o de voz
        function toggleSpeech() {
            const playBtn = document.getElementById('playBtn');
            if (speechSynthesis.paused) {
                speechSynthesis.resume();
                playBtn.textContent = 'üîä Reproduzir';
            } else if (speechSynthesis.speaking) {
                speechSynthesis.pause();
                playBtn.textContent = '‚è∏Ô∏è Pausado';
            } else {
                speakText();
            }
        }
        
        // Configurar inputs de range
        function setupRangeInputs() {
            document.getElementById('rateInput').addEventListener('input', function() {
                document.getElementById('rateValue').textContent = this.value + 'x';
            });
            document.getElementById('pitchInput').addEventListener('input', function() {
                document.getElementById('pitchValue').textContent = this.value;
            });
        }
        
        // Animar o visualizador de onda (simula√ß√£o)
        function animateWaveform(containerId, isActive) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const bars = container.querySelectorAll('.waveform-bar');
            
            if (isActive) {
                const animate = () => {
                    if (mediaRecorder && mediaRecorder.state === 'recording') {
                        bars.forEach((bar) => {
                            const height = Math.random() * 40 + 5;
                            bar.style.height = height + 'px';
                        });
                        setTimeout(animate, 100);
                    } else {
                        bars.forEach(bar => bar.style.height = '5px');
                    }
                };
                animate();
            } else {
                bars.forEach(bar => {
                    bar.style.height = '5px';
                });
            }
        }

        // Carregar vozes dispon√≠veis
        function loadVoices() {
            const voiceSelect = document.getElementById('voiceSelect');
            const voices = speechSynthesis.getVoices();
            
            voiceSelect.innerHTML = '';
            
            voices.forEach((voice, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${voice.name} (${voice.lang})`;
                if (voice.lang.includes('pt')) {
                    option.selected = true;
                }
                voiceSelect.appendChild(option);
            });
        }

        // Recarregar vozes quando dispon√≠veis
        speechSynthesis.onvoiceschanged = loadVoices;

        // Abrir abas
        function openTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.getElementById(tabId).style.display = 'block';
            
            document.querySelectorAll('.tab-button').forEach(b => {
                b.classList.remove('active');
            });
            btn.classList.add('active');
        }
        
        // Fun√ß√£o para mostrar e esconder op√ß√µes do gerador
        function toggleGeneratorOptions() {
            const type = document.getElementById('generatorType').value;
            document.querySelectorAll('#generatorOptions > div').forEach(div => {
                div.classList.remove('active');
            });
            document.getElementById(type + '-options').classList.add('active');
        }

        // --- L√≥gica de convers√£o de n√∫meros para palavras ---
        function numberToWords(num) {
            num = parseInt(num, 10);
            if (num === 0) return 'zero';
            if (num < 0 || num > 999 || isNaN(num)) return null;

            if (num < 10) {
                return unidades[num];
            }
            if (num < 20) {
                return especiais[num - 10];
            }
            if (num < 100) {
                const dezena = dezenas[Math.floor(num / 10)];
                const unidade = unidades[num % 10];
                return unidade === '' ? dezena : `${dezena} e ${unidade}`;
            }
            if (num === 100) {
                return 'cem';
            }
            const centena = centenas[Math.floor(num / 100)];
            const resto = num % 100;
            return `${centena} e ${numberToWords(resto)}`;
        }

        function processTextForNumbers(text) {
            // Substitui n√∫meros por palavras
            return text.replace(/\b(\d{1,3})\b/g, (match, number) => {
                const words = numberToWords(number);
                return words || match; // Retorna o n√∫mero original se a convers√£o falhar
            });
        }
        
        // Fun√ß√£o principal para reproduzir texto
        function speakText() {
            stopSpeech();
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('Por favor, digite algum texto para converter.');
                return;
            }

            const processedText = processTextForNumbers(text);
            
            const utterance = new SpeechSynthesisUtterance(processedText);
            const voices = speechSynthesis.getVoices();
            const voiceIndex = document.getElementById('voiceSelect').value;
            
            utterance.voice = voices[voiceIndex];
            utterance.rate = document.getElementById('rateInput').value;
            utterance.pitch = document.getElementById('pitchInput').value;

            utterance.onstart = () => {
                document.getElementById('speakingAnimation').style.display = 'block';
                document.getElementById('playBtn').textContent = '‚è∏Ô∏è Pausar';
            };

            utterance.onend = () => {
                document.getElementById('speakingAnimation').style.display = 'none';
                document.getElementById('playBtn').textContent = 'üîä Reproduzir';
            };

            utterance.onerror = (event) => {
                console.error('Erro na s√≠ntese de voz:', event.error);
                document.getElementById('speakingAnimation').style.display = 'none';
                document.getElementById('playBtn').textContent = 'üîä Reproduzir';
            };

            currentUtterance = utterance;
            speechSynthesis.speak(utterance);
        }

        // Parar reprodu√ß√£o
        function stopSpeech() {
            if (currentUtterance && speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            document.getElementById('speakingAnimation').style.display = 'none';
            document.getElementById('playBtn').textContent = 'üîä Reproduzir';
        }

        // Gerar e salvar MP3 do texto (aviso para o usu√°rio)
        function generateAndSaveMP3() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('Por favor, digite algum texto para converter.');
                return;
            }
            alert('A fun√ß√£o de gerar MP3 a partir da voz do navegador n√£o est√° dispon√≠vel. Use a grava√ß√£o para salvar em MP3.');
        }

        // Fun√ß√£o de soletra√ß√£o
        function spellWord() {
            stopSpeech();
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('Por favor, digite uma palavra para soletrar.');
                return;
            }

            const letters = text.replace(/[^a-zA-Z]/g, '').toUpperCase().split('');
            const speakNextLetter = (index) => {
                if (index >= letters.length) {
                    document.getElementById('speakingAnimation').style.display = 'none';
                    return;
                }
                const letter = letters[index];
                const utterance = new SpeechSynthesisUtterance(letter);
                const voices = speechSynthesis.getVoices();
                const voiceIndex = document.getElementById('voiceSelect').value;

                utterance.voice = voices[voiceIndex];
                utterance.rate = document.getElementById('rateInput').value;
                utterance.pitch = document.getElementById('pitchInput').value;

                utterance.onstart = () => {
                    document.getElementById('speakingAnimation').style.display = 'block';
                };
                utterance.onend = () => {
                    setTimeout(() => speakNextLetter(index + 1), 300);
                };
                speechSynthesis.speak(utterance);
            };
            speakNextLetter(0);
        }

        // --- L√≥gica de Comando por Voz ---
        function setupVoiceRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.lang = 'pt-BR';
                recognition.continuous = true;
                recognition.interimResults = false;

                recognition.onstart = () => {
                    isVoiceCommandActive = true;
                    document.getElementById('micStatus').style.display = 'block';
                    document.getElementById('mic-icon').textContent = 'üî¥';
                    document.getElementById('mic-text').textContent = 'Ouvindo...';
                };

                recognition.onend = () => {
                    isVoiceCommandActive = false;
                    document.getElementById('micStatus').style.display = 'none';
                    document.getElementById('mic-icon').textContent = 'üéôÔ∏è';
                    document.getElementById('mic-text').textContent = 'Ativar Comando por Voz';
                };
                
                recognition.onerror = (event) => {
                    console.error('Erro no reconhecimento de voz:', event.error);
                    alert('Erro no reconhecimento de voz. Verifique as permiss√µes do microfone.');
                    isVoiceCommandActive = false;
                    document.getElementById('micStatus').style.display = 'none';
                };

                recognition.onresult = (event) => {
                    const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
                    processVoiceCommand(transcript);
                };
            } else {
                alert('O reconhecimento de voz n√£o √© suportado por este navegador.');
            }
        }

        function toggleVoiceCommand() {
            if (isVoiceCommandActive) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function processVoiceCommand(command) {
            console.log('Comando recebido:', command);

            if (command.includes('limpar texto') || command.includes('apagar texto')) {
                document.getElementById('textInput').value = '';
                speakFullText('Texto limpo.');
                return;
            }

            if (command.includes('reproduzir')) {
                speakText();
                return;
            }
            
            if (command) {
                document.getElementById('textInput').value = command;
            }
        }

        // Fun√ß√£o de fala para a assistente (opcional)
        function speakFullText(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = speechSynthesis.getVoices();
            if (voices.length > 0) {
                const ptVoice = voices.find(v => v.lang.includes('pt'));
                if (ptVoice) {
                    utterance.voice = ptVoice;
                }
            }
            speechSynthesis.speak(utterance);
        }

        // --- Fun√ß√µes de Grava√ß√£o e Gerenciamento ---
        
        function selectRecordQuality(quality, btn) {
            document.querySelectorAll('#record .quality-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            recordQuality = quality;
        }

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const options = { mimeType: 'audio/webm' };
                    if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                        options.mimeType = 'audio/ogg';
                    }
                    if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                         alert('Nenhum formato de grava√ß√£o WebM ou Ogg √© suportado.');
                         return;
                    }

                    mediaRecorder = new MediaRecorder(stream, options);
                    audioChunks = [];
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: options.mimeType });
                        
                        convertToMP3(audioBlob, recordQuality, mp3Blob => {
                            currentAudioBlob = mp3Blob;
                            const audioPlayer = document.getElementById('recordAudioPlayer');
                            audioPlayer.src = URL.createObjectURL(mp3Blob);
                            document.getElementById('recordPlayer').style.display = 'block';
                            document.getElementById('saveRecordBtn').style.display = 'inline-flex';
                            
                            stream.getTracks().forEach(track => track.stop());
                        });
                    };

                    mediaRecorder.start();
                    document.getElementById('recordingStatus').style.display = 'block';
                    document.getElementById('recordWaveform').style.display = 'block';
                    document.getElementById('startRecordBtn').disabled = true;
                    document.getElementById('stopRecordBtn').disabled = false;
                    animateWaveform('recordWaveformBars', true);
                })
                .catch(err => {
                    console.error('Erro ao acessar o microfone:', err);
                    alert('Erro ao acessar o microfone. Verifique as permiss√µes do navegador.');
                });
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }
            document.getElementById('recordingStatus').style.display = 'none';
            document.getElementById('startRecordBtn').disabled = false;
            document.getElementById('stopRecordBtn').disabled = true;
            animateWaveform('recordWaveformBars', false);
        }

        function convertToMP3(audioBlob, quality, callback) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const arrayBuffer = event.target.result;
                const { bitRate, sampleRate } = qualitySettings[quality];

                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                audioContext.decodeAudioData(arrayBuffer).then(audioBuffer => {
                    const pcmData = audioBuffer.getChannelData(0);
                    const samples = new Int16Array(pcmData.length);
                    
                    for (let i = 0; i < pcmData.length; i++) {
                        samples[i] = pcmData[i] * 32767;
                    }

                    const mp3encoder = new lamejs.Mp3Encoder(1, audioBuffer.sampleRate, bitRate);
                    const mp3Data = [];
                    const samplesPerFrame = 1152;
                    
                    for (let i = 0; i < samples.length; i += samplesPerFrame) {
                        const sampleChunk = samples.subarray(i, i + samplesPerFrame);
                        const mp3buf = mp3encoder.encodeBuffer(sampleChunk);
                        if (mp3buf.length > 0) {
                            mp3Data.push(new Int8Array(mp3buf));
                        }
                    }
                    const mp3buf = mp3encoder.flush();
                    if (mp3buf.length > 0) {
                        mp3Data.push(new Int8Array(mp3buf));
                    }
                    
                    const mp3Blob = new Blob(mp3Data, { type: 'audio/mp3' });
                    callback(mp3Blob);
                }).catch(err => {
                    console.error('Erro ao decodificar √°udio:', err);
                    alert('Erro ao converter para MP3. Verifique o formato do arquivo de origem.');
                });
            };
            reader.readAsArrayBuffer(audioBlob);
        }

        function saveAudio(blob, type, name) {
            const reader = new FileReader();
            reader.onloadend = function() {
                const base64data = reader.result;
                const audio = {
                    id: Date.now(),
                    name: name || `Audio ${savedAudios.length + 1} (${type})`,
                    date: new Date().toLocaleDateString('pt-BR'),
                    blob: base64data,
                    type: type
                };
                savedAudios.push(audio);
                localStorage.setItem('savedAudios', JSON.stringify(savedAudios));
                updateSavedAudiosList();
            };
            reader.readAsDataURL(blob);
        }

        function saveRecordedMP3() {
            if (currentAudioBlob) {
                saveAudio(currentAudioBlob, 'record');
                alert('Grava√ß√£o salva com sucesso!');
                document.getElementById('saveRecordBtn').style.display = 'none';
            } else {
                alert('Nenhum √°udio gravado para salvar.');
            }
        }
        
        function updateSavedAudiosList() {
            const list = document.getElementById('savedAudiosList');
            if (savedAudios.length === 0) {
                list.innerHTML = '<p>Nenhum √°udio MP3 salvo ainda.</p>';
                return;
            }

            list.innerHTML = '';
            savedAudios.forEach(audio => {
                const item = document.createElement('div');
                item.className = 'audio-item';
                item.innerHTML = `
                    <div class="audio-info">
                        <div class="audio-title">${audio.name}</div>
                        <div class="audio-date">${audio.date}</div>
                    </div>
                    <div class="audio-actions">
                        <button class="btn btn-primary" onclick="playSavedAudio('${audio.id}')">‚ñ∂Ô∏è Play</button>
                        <button class="btn btn-secondary" onclick="downloadSavedAudio('${audio.id}')">‚¨áÔ∏è Download</button>
                        <button class="btn btn-danger" onclick="deleteSavedAudio('${audio.id}')">üóëÔ∏è Excluir</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function playSavedAudio(id) {
            const audio = savedAudios.find(a => a.id == id);
            if (audio) {
                const audioBlob = dataURLtoBlob(audio.blob);
                const audioUrl = URL.createObjectURL(audioBlob);
                const tempAudio = new Audio(audioUrl);
                tempAudio.play();
                tempAudio.onended = () => {
                    URL.revokeObjectURL(audioUrl);
                };
            }
        }

        function downloadSavedAudio(id) {
            const audio = savedAudios.find(a => a.id == id);
            if (audio) {
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = audio.blob;
                a.download = `${audio.name.replace(/ /g, '_')}.mp3`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }

        function deleteSavedAudio(id) {
            if (confirm('Tem certeza de que deseja excluir este √°udio?')) {
                savedAudios = savedAudios.filter(a => a.id != id);
                localStorage.setItem('savedAudios', JSON.stringify(savedAudios));
                updateSavedAudiosList();
            }
        }

        function clearAllAudios() {
            if (confirm('Tem certeza de que deseja limpar todos os √°udios salvos? Esta a√ß√£o n√£o pode ser desfeita.')) {
                savedAudios = [];
                localStorage.removeItem('savedAudios');
                updateSavedAudiosList();
            }
        }

        function downloadCurrentMP3() {
            if (currentMP3Blob) {
                const url = URL.createObjectURL(currentMP3Blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'audio_gerado.mp3';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } else {
                alert('Nenhum √°udio para download.');
            }
        }

        function downloadRecordedMP3() {
            if (currentAudioBlob) {
                const url = URL.createObjectURL(currentAudioBlob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = 'audio_gravado.mp3';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
            } else {
                alert('Nenhum √°udio para download.');
            }
        }

        function importMP3s() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'audio/mp3';
            input.multiple = true;
            input.style.display = 'none';
            document.body.appendChild(input);

            input.onchange = (event) => {
                const files = event.target.files;
                if (files.length > 0) {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            const audio = {
                                id: Date.now() + i,
                                name: file.name.replace('.mp3', ''),
                                date: new Date().toLocaleDateString('pt-BR'),
                                blob: reader.result,
                                type: 'imported'
                            };
                            savedAudios.push(audio);
                            localStorage.setItem('savedAudios', JSON.stringify(savedAudios));
                            updateSavedAudiosList();
                        };
                        reader.readAsDataURL(file);
                    }
                    alert('√Åudios importados com sucesso!');
                }
                document.body.removeChild(input);
            };
            input.click();
        }
        
        function dataURLtoBlob(dataurl) {
            const arr = dataurl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            return new Blob([u8arr], { type: mime });
        }
        
        // --- Novas fun√ß√µes para a aba Gerador de √Åudios ---
        
        let generatedBlobs = [];
        
        async function generateAudioFiles() {
            const type = document.getElementById('generatorType').value;
            const loadingDiv = document.getElementById('generatorLoading');
            const listDiv = document.getElementById('generatedAudioItems');
            
            loadingDiv.style.display = 'block';
            listDiv.innerHTML = '';
            generatedBlobs = [];
            
            let itemsToGenerate = [];

            if (type === 'numbers') {
                const start = parseInt(document.getElementById('startNumber').value);
                const end = parseInt(document.getElementById('endNumber').value);
                for (let i = start; i <= end; i++) {
                    itemsToGenerate.push({
                        text: numberToWords(i),
                        name: `N√∫mero ${i}`
                    });
                }
            } else if (type === 'specific_numbers') {
                const input = document.getElementById('specificNumbersInput').value;
                const numbers = input.split(',').map(n => n.trim()).filter(n => n !== '');
                numbers.forEach(num => {
                    itemsToGenerate.push({
                        text: numberToWords(parseInt(num, 10)),
                        name: `N√∫mero ${num}`
                    });
                });
            } else if (type === 'letters') {
                const input = document.getElementById('lettersInput').value;
                const letters = input.toUpperCase().split(',').map(l => l.trim()).filter(l => l !== '');
                letters.forEach(letter => {
                    itemsToGenerate.push({
                        text: letter,
                        name: `Letra ${letter}`
                    });
                });
            }

            for (const item of itemsToGenerate) {
                try {
                    const blob = await new Promise(resolve => {
                        generateTTSBlob(item.text, resolve);
                    });
                    generatedBlobs.push({
                        name: item.name,
                        blob: blob
                    });
                } catch (error) {
                    console.error('Erro ao gerar √°udio:', error);
                }
            }

            loadingDiv.style.display = 'none';
            document.getElementById('generatedAudioList').style.display = 'block';
            
            generatedBlobs.forEach((item, index) => {
                const audioItem = document.createElement('div');
                audioItem.className = 'audio-item';
                audioItem.innerHTML = `
                    <div class="audio-info">
                        <div class="audio-title">${item.name}</div>
                    </div>
                    <div class="audio-actions">
                        <button class="btn btn-primary" onclick="playGeneratedAudio(${index})">‚ñ∂Ô∏è Play</button>
                        <button class="btn btn-secondary" onclick="downloadGeneratedAudio(${index})">‚¨áÔ∏è Download</button>
                        <button class="btn btn-success" onclick="saveGeneratedAudio(${index})">üíæ Salvar</button>
                    </div>
                `;
                listDiv.appendChild(audioItem);
            });
            alert('√Åudios gerados com sucesso!');
        }
        
        function playGeneratedAudio(index) {
            const audio = generatedBlobs[index];
            if (audio) {
                const url = URL.createObjectURL(audio.blob);
                const tempAudio = new Audio(url);
                tempAudio.play();
            }
        }
        
        function downloadGeneratedAudio(index) {
            const audio = generatedBlobs[index];
            if (audio) {
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = URL.createObjectURL(audio.blob);
                a.download = `${audio.name.replace(/ /g, '_')}.mp3`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }

        function downloadAllGeneratedAudios() {
            if (generatedBlobs.length === 0) {
                alert('Nenhum √°udio para baixar.');
                return;
            }
            
            const zip = new JSZip();
            const folder = zip.folder("audios-gerados");

            generatedBlobs.forEach(item => {
                folder.file(`${item.name}.mp3`, item.blob);
            });

            zip.generateAsync({ type: "blob" }).then(content => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(content);
                a.download = "audios_bingo.zip";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
        }

        function saveGeneratedAudio(index) {
            const audio = generatedBlobs[index];
            if (audio) {
                saveAudio(audio.blob, 'generated', audio.name);
                alert(`√Åudio "${audio.name}" salvo na biblioteca!`);
            }
        }

        // Fun√ß√£o para gerar um Blob de √°udio a partir de um texto (simula√ß√£o)
        // Nota: A API Web Speech n√£o oferece uma maneira direta de salvar a sa√≠da de √°udio.
        // Este √© um m√©todo de simula√ß√£o que pode n√£o funcionar perfeitamente em todos os navegadores.
        function generateTTSBlob(text, callback) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = speechSynthesis.getVoices();
            const voiceIndex = document.getElementById('voiceSelect').value;
            
            utterance.voice = voices[voiceIndex];
            utterance.rate = document.getElementById('rateInput').value;
            utterance.pitch = document.getElementById('pitchInput').value;
            
            const mediaStreamDestination = audioContext.createMediaStreamDestination();
            const mediaRecorder = new MediaRecorder(mediaStreamDestination.stream);
            
            const chunks = [];
            mediaRecorder.ondataavailable = (event) => {
                chunks.push(event.data);
            };
            
            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(chunks, { type: 'audio/webm' });
                callback(audioBlob);
            };

            mediaRecorder.start();
            speechSynthesis.speak(utterance);
            
            utterance.onend = () => {
                mediaRecorder.stop();
            };
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</body>
</html>
